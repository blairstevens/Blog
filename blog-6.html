<!DOCTYPE html>
<html lang="en">
<head>
 <title>Gazpacho Scraping</title>
 <!-- Latest compiled and minified CSS -->
 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
 <div class="container">
  <h1><a href="https://blairstevens.github.io/Blog">Data_Snapshot</a></h1>
 </div>
</head>
<body>
 <div class="container">
<div class="row">
 <div class="col-md-8">
  <h3>Gazpacho Scraping</h3>
  <label>2019-10-16</label>
  <p>This a rework of my original web scraping post. I will be endevouring to use gazpacho instead of requests and BeautifulSoup.</p>
<p>Why gazpacho? It's lighter weight, more pythonic, cooler and spicier. What's not to like?</p>
<p>Somewhere in your data science journey you will need to scrape a webpage. This post will try to get you up and running as fast as possible. </p>
<p>To start we need to import gazpacho.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gazpacho</span> <span class="kn">as</span> <span class="nn">gz</span>
</pre></div>


<p>Now we are going to identify a page to scrape. Our target is going to be band members from their Discogs page. In this case it's going to be Larkin Poe because they are awesome and you should be listening to them. We will stuff the url into a variable and then use request.get to retrieve the data.</p>
<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://www.discogs.com/artist/2487986-Larkin-Poe&#39;</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>


<p>Now we have stuffed the HTML code into resp. You may want to take a look through the full page code to familiarize yourself with some html, however if I were to do that this would become a very long blog post. Instead I have printed the first five hundred characters below to give you a taste.</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">resp</span><span class="p">[:</span><span class="mi">500</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span>
    <span class="na">class</span><span class="o">=</span><span class="s">&quot;is_not_mobile needs_reduced_ui &quot;</span>
    <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span>
    <span class="na">xmlns:og</span><span class="o">=</span><span class="s">&quot;http://opengraphprotocol.org/schema/&quot;</span>
    <span class="na">xmlns:fb</span><span class="o">=</span><span class="s">&quot;http://www.facebook.com/2008/fbml&quot;</span>
<span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;content-language&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;pragma&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;no-cache&quot;</span> <span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;expires&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;-1&quot;</span> <span class="p">/&gt;</span>

                <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewp</span>
</pre></div>


<p>This is the spot that BeautifulSoup would come in, but instead we just continue using gazpacho. Different syntax from BeautifulSoup but just as accessible. Calling the soup method parses the html like BeautifulSoup would have, and then we call the find method with our class and flags to strip out what we need.</p>
<div class="highlight"><pre><span></span><span class="n">soup</span> <span class="o">=</span> <span class="n">gz</span><span class="o">.</span><span class="n">Soup</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>

<span class="n">found</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;readmore&#39;</span><span class="p">})</span>
<span class="n">found</span>
</pre></div>


<div class="highlight"><pre><span></span>[<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;readmore&quot;</span> <span class="na">id=</span><span class="s">&quot;profile&quot;</span><span class="nt">&gt;</span>
             Rebecca <span class="err">&amp;</span> Megan Lovell
                     <span class="nt">&lt;/div&gt;</span>, <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;readmore&quot;</span><span class="nt">&gt;</span>

                     <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/artist/4443794-Megan-Lovell&quot;</span><span class="nt">&gt;</span>Megan Lovell<span class="nt">&lt;/a&gt;</span>, 
                     <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/artist/3126405-Rebecca-Lovell&quot;</span><span class="nt">&gt;</span>Rebecca Lovell<span class="nt">&lt;/a&gt;</span>            <span class="nt">&lt;/div&gt;</span>]
</pre></div>


<p>If you have just come from my other webscraping post you will notice this has all happened in a few less lines of python. It feels like 20 percent less, which in this realtively straigthtforward case translates to one fewer line of code. However this is going to scale as your webscraping becomes more complex, and having all of the functionality inside gazpacho is going to mean less lines for you to write, and less lines for you to fix.</p>
<p>The following code is the regex and related functions that I used to strip the info down to a list. It live slightly beyond the BeautifulSoup/requests/gazpacho world, and therefore has been left untouched.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">regular</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b[A-Z].*&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">found</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="n">regular</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>[&#39;Rebecca <span class="err">&amp;</span> Megan Lovell&#39;, &#39;Megan-Lovell&quot;&gt;Megan Lovell<span class="nt">&lt;/a&gt;</span>, &#39;, &#39;Rebecca-Lovell&quot;&gt;Rebecca Lovell<span class="nt">&lt;/a&gt;</span>            <span class="nt">&lt;/div&gt;</span>]&#39;]
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cleaner</span><span class="p">(</span><span class="n">in_list</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">regular</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">b</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">done</span> <span class="o">=</span> <span class="n">cleaner</span><span class="p">(</span><span class="n">regular</span><span class="p">)</span>
<span class="n">done</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Megan Lovell&#39;</span><span class="p">,</span> <span class="s1">&#39;Rebecca Lovell&#39;</span><span class="p">]</span>
</pre></div>


<p>Gazpacho brings everything together in an efficient way, similar to how you've done it before, but producing a lower overhead and faster output. For me its a drop in replacement, and at this point gazpacho is my first choice when it comes to scraping.</p>
 </div>
</div>
 </div>
</body>
</html>